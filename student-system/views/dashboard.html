<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±</title>
  <script>
    // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø¯ÙˆØ± Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø· Ù„Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±
    (function(){
      try {
        const role = localStorage.getItem('role');
        if (!role || role !== 'developer') {
          // Ù„ÙŠØ³ Ù…Ø·ÙˆØ±Ø§Ù‹ -> Ø£Ø¹ÙØ¯ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          window.location.href = 'login.html';
        }
      } catch (e) {
        window.location.href = 'login.html';
      }
    })();
  </script>
  <!-- External JS modules (deferred). Load helpers first (main.js) so shared helpers exist -->
  <script src="/js/main.js" defer></script>
  <script src="/js/admin.js" defer></script>
  <script src="/js/students.js" defer></script>
  <script src="/js/books.js" defer></script>
  <script src="/js/videos.js" defer></script>
  <style>
    :root {
      --primary: #28a745;
      --primary-dark: #1e7e34;
      --danger: #dc3545;
      --danger-dark: #a71d2a;
      --bg: #f3f4f6;
      --card-bg: #fff;
      --text-color: #222;
    }
    *{box-sizing:border-box; margin:0; padding:0;}
    body{font-family:"Cairo",sans-serif; background:var(--bg); color:var(--text-color);}
    header{background:linear-gradient(135deg,var(--primary),#20c997); color:white; padding:15px; text-align:center; font-size:24px; font-weight:bold;}
    .container{display:grid; grid-template-columns:220px 1fr; min-height:calc(100vh - 60px);}
    .sidebar{background:var(--card-bg); border-left:3px solid var(--primary); box-shadow:0 0 10px rgba(0,0,0,0.1); padding:20px;}
    .sidebar h3{text-align:center; margin-bottom:20px; color:var(--text-color);}
    .sidebar button{display:block; width:100%; padding:12px; margin-bottom:10px; border:none; background:var(--primary); color:white; border-radius:8px; cursor:pointer; transition:0.3s;}
    .sidebar button:hover{background:var(--primary-dark);}
    .sidebar .logout{background:var(--danger) !important;}
    .sidebar .logout:hover{background:var(--danger-dark) !important;}
    .content{padding:25px; overflow-y:auto;}
    .card{background:var(--card-bg); padding:15px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); margin-bottom:20px;}
    .form-row{display:flex; flex-wrap:wrap; gap:10px; margin-bottom:12px;}
    .form-row > *{flex:1 1 180px;}
    input, select, textarea{width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-size:14px; color:#222; background:#fff;}
    button{padding:10px 14px; border-radius:8px; border:0; background:var(--primary); color:white; cursor:pointer;}
    button.secondary{background:#6c757d;}
    table{width:100%; border-collapse:collapse;}
    th,td{text-align:center; padding:8px; border-bottom:1px solid #eee;}
    th{background:#f1f3f5;}
    .small-btn{padding:6px 8px; border-radius:6px; border:0; cursor:pointer;}
    .edit{background:#ffc107; color:#000;}
    .del{background:var(--danger);}
    .success{color:green; font-weight:bold;}
    .error{color:var(--danger); font-weight:bold;}
    .muted{color:#6c757d;}
    img.thumb{width:60px; height:70px; object-fit:cover; border-radius:6px;}
    .panel{display:none;}
    .panel.active{display:block;}
    @media(max-width:992px){ .container{grid-template-columns:180px 1fr;} .form-row{flex-direction:column;} th,td{font-size:13px;padding:6px;} img.thumb{width:48px;height:56px;} }
    @media(max-width:720px){ .container{grid-template-columns:1fr;} .sidebar{display:flex; overflow-x:auto; gap:10px; border-left:none; border-bottom:3px solid var(--primary);} .sidebar h3{display:none;} .sidebar button{flex:1 0 auto;} .form-row{flex-direction:column;} th,td{font-size:12px;padding:4px;} img.thumb{width:40px;height:48px;} }
  </style>
</head>
<body>
  <header>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±</header>

  <div class="container">
    <div class="sidebar">
      <h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
      <button data-tab="admins" class="active">Ø§Ù„Ø£Ø¯Ù…Ù†Ø²</button>
        <button data-tab="developer">Ø§Ù„Ù…Ø·ÙˆØ±</button>
      <button data-tab="students">Ø§Ù„Ø·Ù„Ø§Ø¨</button>
      <button data-tab="books">Ø§Ù„ÙƒØªØ¨</button>
      <button data-tab="videos">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button>
      <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="content">
      <!-- Admins -->
      <div id="admins" class="panel active card">
        <h3>ğŸ§‘â€ğŸ’¼ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù†Ø²</h3>
        <div class="form-row">
          <input id="newAdminUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
          <input id="newAdminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
          <button id="addAdminBtn">â• Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ù…Ù†</button>
          <button id="openStudentDetailsFromAdmin" class="secondary">Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
        </div>
        <p id="adminMsg" class="muted"></p>
        <table id="adminsTable">
          <thead><tr><th>Ø§Ù„Ù…Ø¹Ø±Ù</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
          <tbody><tr><td colspan="4" class="muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
        </table>
      </div>

      <!-- Students -->
      <div id="students" class="panel card">
        <h3>ğŸ‘©â€ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
        <div class="form-row">
          <input id="stu_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
          <input id="stu_phone" placeholder="Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨">
          <input id="stu_parent" placeholder="Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±">
          <select id="stu_grade">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
            <option>Ø«Ø§Ù„Ø«Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
            <option>Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
            <option>Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
            <option>Ø«Ø§Ù„Ø«Ø© Ø«Ø§Ù†ÙˆÙŠ</option>
          </select>
          <button id="addStudentBtn">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
        </div>
        <p id="studentMsg" class="muted"></p>
        <table id="studentsTable">
          <thead><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ù‡Ø§ØªÙ</th><th>ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead>
          <tbody><tr><td colspan="8" class="muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
        </table>
      </div>

      <!-- Books -->
      <div id="books" class="panel card">
        <h3>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØªØ¨</h3>
        <div class="form-row">
          <input id="book_title" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨">
          <input id="book_desc" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ±">
        </div>
        <div class="form-row">
          <input id="book_cover" type="file" accept="image/*">
          <input id="book_pdf" type="file" accept="application/pdf">
          <button id="uploadBookBtn">ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ÙƒØªØ§Ø¨</button>
        </div>
        <p id="bookMsg" class="muted"></p>
        <table id="booksTable">
          <thead><tr><th>ØºÙ„Ø§Ù</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„ÙˆØµÙ</th><th>ØªØ­Ù…ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead>
          <tbody><tr><td colspan="5" class="muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
        </table>
      </div>

      <!-- Videos -->
      <div id="videos" class="panel card">
        <h3>ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
        <div class="form-row">
          <input id="video_title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
          <input id="video_url" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ÙƒØ§Ù…Ù„">
          <select id="grade">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
          </select>
          <button id="addVideoBtn">â• Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ</button>
        </div>
        <p id="videoMsg" class="muted"></p>
        <table id="videosTable">
          <thead><tr><th>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø±Ø§Ø¨Ø·</th><th>Ø§Ù„ØµÙ</th><th>Ø­Ø°Ù</th></tr></thead>
          <tbody><tr><td colspan="5" class="muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
        </table>
      </div>

      <!-- Developer -->
      <div id="developer" class="panel card">
        <h3>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±</h3>
        <div class="form-row">
          <button id="openStudentDetailsFromDev">Ø¹Ø±Ø¶ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
        </div>
        <p class="muted">Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù…Ø·ÙˆØ±: Ø§ÙØªØ­ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø·Ø§Ù„Ø¨ ÙÙŠ ØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯.</p>
      </div>
    </div>
  </div>
    <!-- Diagnostic helper: shows console info about loaded scripts and functions -->
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          console.group('dashboard-diagnostics');
          console.log('DOM loaded');
          const status = {
            showMsg: typeof showMsg,
            loadAdmins: typeof loadAdmins,
            loadStudents: typeof loadStudents,
            loadBooks: typeof loadBooks,
            loadVideos: typeof loadVideos,
            logout: typeof logout
          };
          console.log('function types:', status);

          try {
            const r = await fetch('/js/main.js');
            console.log('/js/main.js fetch status:', r.status);
          } catch (err) {
            console.warn('fetch /js/main.js failed:', err.message || err);
          }

          // attach a quick click detector to the first sidebar button
          const testBtn = document.querySelector('.sidebar button[data-tab]');
          if (testBtn) {
            testBtn.addEventListener('click', () => console.log('sidebar button clicked'));
          }

          // visual banner
          const b = document.createElement('div');
          b.id = 'diag-banner';
          b.textContent = 'Diagnostics: open console for details';
          Object.assign(b.style, {position:'fixed', left:'12px', bottom:'12px', padding:'8px 12px', background:'#222', color:'#fff', borderRadius:'6px', zIndex:9999, opacity:0.9});
          document.body.appendChild(b);
          console.groupEnd();
        } catch (e) {
          console.error('diagnostic error', e);
        }
      });
    </script>
</body>
</html>
